{% extends 'app/admin/base.html' %}

{% block content %}
<div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
    
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
        <a href="{% url 'orders' %}" style="text-decoration: none; color: #6b7280; font-size: 24px;">
            ‚¨ÖÔ∏è
        </a>
        <div>
            <h2 style="color: #333; font-size: 24px; font-weight: 700; margin: 0;">Manage Order #{{ order.id }}</h2>
            <p style="color: #6b7280; font-size: 14px; margin-top: 4px;">
                Customer: <b>{{ order.user.username }}</b> | Date: {{ order.created_at|date:"d M Y, H:i" }}
            </p>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 350px; gap: 30px;">
        
        <div style="background: white; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; height: fit-content;">
            <div style="padding: 20px; border-bottom: 1px solid #f3f4f6;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 700; color: #374151;">Order Items</h3>
            </div>
            
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead style="background: #f9fafb; font-size: 12px; text-transform: uppercase; color: #6b7280;">
                    <tr>
                        <th style="padding: 15px 20px;">Product Name</th>
                        <th style="padding: 15px 20px;">Price</th>
                        <th style="padding: 15px 20px; text-align: center;">Qty</th>
                        <th style="padding: 15px 20px; text-align: right;">Subtotal</th>
                    </tr>
                </thead>
                <tbody style="font-size: 14px; color: #374151;">
                    {% for order_item in order.items.all %}
                    <tr style="border-bottom: 1px solid #f3f4f6;">
                        <td style="padding: 15px 20px;">
                            <div style="font-weight: 600;">{{ order_item.item.name }}</div>
                            <div style="font-size: 12px; color: #9ca3af;">
                                {{ order_item.item.color|default:"-" }} / {{ order_item.item.size|default:"-" }}
                            </div>
                        </td>
                        <td style="padding: 15px 20px;">
                            Rp {{ order_item.price|floatformat:0 }}
                        </td>
                        <td style="padding: 15px 20px; text-align: center;">
                            {{ order_item.quantity }}
                        </td>
                        <td style="padding: 15px 20px; text-align: right; font-weight: 600;">
                            Rp {% widthratio order_item.price 1 order_item.quantity %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot style="background: #f9fafb;">
                    <tr>
                        <td colspan="3" style="padding: 15px 20px; text-align: right; font-weight: 700; color: #374151;">TOTAL AMOUNT</td>
                        <td style="padding: 15px 20px; text-align: right; font-weight: 800; color: #4f46e5; font-size: 16px;">
                            Rp {{ order.total_price|floatformat:0 }}
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div style="height: fit-content;">
            <form method="POST" class="custom-form" style="background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                {% csrf_token %}
                
                <h3 style="margin: 0 0 20px 0; font-size: 16px; font-weight: 700; color: #374151;">Update Status</h3>

                <div style="margin-bottom: 20px; padding: 10px; background: #f3f4f6; border-radius: 8px; text-align: center;">
                    <span style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 4px;">Current Status</span>
                    <span style="font-weight: 700; color: #1f2937; text-transform: uppercase;">{{ order.get_status_display }}</span>
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px;">Change Status To:</label>
                    {{ form.status }}
                </div>

                <button type="submit" style="width: 100%; padding: 12px; background: #4f46e5; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);">
                    Save Changes
                </button>
                
                <a href="{% url 'orders' %}" style="display: block; text-align: center; margin-top: 15px; font-size: 13px; color: #6b7280; text-decoration: none;">
                    Cancel
                </a>

            </form>

            <div style="margin-top: 20px; background: #fffbeb; border: 1px solid #fcd34d; padding: 15px; border-radius: 12px;">
                <p style="margin: 0; font-size: 12px; color: #92400e; line-height: 1.5;">
                    üí° <b>Note:</b><br>
                    Pastikan pembayaran sudah diterima sebelum mengubah status menjadi <b>Packed</b> atau <b>Completed</b>.
                </p>
            </div>
        </div>

    </div>
</div>

<style>
    .custom-form select {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        outline: none;
        background-color: white;
        font-family: inherit;
        font-size: 14px;
        cursor: pointer;
        transition: border 0.2s;
    }
    .custom-form select:focus {
        border-color: #4f46e5;
    }
</style>
{% endblock %}